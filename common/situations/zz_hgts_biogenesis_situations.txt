#Shortened behemoth situation
#fixed evopred bugs

behemoth_finale_situation = {
	picture = GFX_evt_mechromancy
	complete_icon_frame = GFX_situation_outcome_frame_green
	complete_icon = GFX_situation_outcome_challenge
	category = positive
	initial_progress = 0

	on_progress_complete = {
		custom_tooltip = behemoth_finale_situation_outcome
		hidden_effect = {
			situation_event = { id = biocrisis.250 }
			owner = {
				remove_modifier = voidspawn_boss_invincible
				set_country_flag = finished_behemoth_situation
			}
		}
	}

	stages = {
		stage_1 = {
			icon = GFX_situation_stage_1
			icon_background = GFX_situation_stage_frame_blue
			end = 80
			on_first_enter = {
				situation_event = { id = biocrisis.210 days = 30 }
			}
			custom_tooltip = "stage_behemoth_finale_effects_regular"
		}
		stage_2 = {
			icon = GFX_situation_stage_2
			icon_background = GFX_situation_stage_frame_blue
			end = 180
			on_first_enter = {
				situation_event = { id = biocrisis.150 } #Spawn the Voidspawn
				situation_event = { id = biocrisis.215 days = 7 }
				owner = {
					add_modifier = {
						modifier = behemoth_transference
						days = -1
						mult = 2
					}
				}
			}
			custom_tooltip = "stage_behemoth_finale_effects_regular"
		}
		stage_3 = {
			icon = GFX_situation_stage_3
			icon_background = GFX_situation_stage_frame_blue
			end = 300
			on_first_enter = {
				situation_event = { id = biocrisis.220 days = 2 }
				owner = {
					add_modifier = {
						modifier = behemoth_transference
						days = -1
						mult = 3
					}
				}
			}
			custom_tooltip = "stage_behemoth_finale_effects"
		}
		stage_4 = {
			icon = GFX_situation_stage_4
			icon_background = GFX_situation_stage_frame_blue
			end = 440
			on_first_enter = {
				situation_event = { id = biocrisis.225 days = 2 }
				owner = {
					add_modifier = {
						modifier = behemoth_transference
						days = -1
						mult = 4
					}
				}
			}
			custom_tooltip = "stage_behemoth_finale_effects_regular"
		}
		stage_5 = {
			icon = GFX_situation_stage_5
			icon_background = GFX_situation_stage_frame_blue
			end = 600
			on_first_enter = {
				situation_event = { id = biocrisis.230 days = 2 }
				owner = {
					add_modifier = {
						modifier = behemoth_transference
						days = -1
						mult = 5
					}
				}
			}
			custom_tooltip = "stage_behemoth_finale_effects_regular"
		}
		stage_6 = {
			icon = GFX_situation_stage_6
			icon_background = GFX_situation_stage_frame_blue
			end = 780
			on_first_enter = {
				situation_event = { id = biocrisis.235 days = 2 }
				owner = {
					add_modifier = {
						modifier = behemoth_transference
						days = -1
						mult = 6
					}
				}
			}
			custom_tooltip = "stage_behemoth_finale_effects"
		}
		stage_7 = {
			icon = GFX_situation_stage_7
			icon_background = GFX_situation_stage_frame_blue
			end = 980
			on_first_enter = {
				situation_event = { id = biocrisis.240 days = 2 }
				owner = {
					add_modifier = {
						modifier = behemoth_transference
						days = -1
						mult = 7
					}
				}
			}
			custom_tooltip = "stage_behemoth_finale_effects"
		}
		stage_8 = {
			icon = GFX_situation_stage_8
			icon_background = GFX_situation_stage_frame_blue
			end = 1200
			on_first_enter = {
				situation_event = { id = biocrisis.245 days = 2 }
				owner = {
					add_modifier = {
						modifier = behemoth_transference
						days = -1
						mult = 8
					}
				}
			}
			custom_tooltip = "stage_behemoth_finale_effects"
		}
	}

	monthly_progress = {
		add = 1
		modifier = {
			add = 2
			desc = approach_digestion
			current_situation_approach = behemoth_finale_approach_digestion
		}
		modifier = {
			add = -0.75
			desc = approach_brawn
			current_situation_approach = behemoth_finale_approach_brawn
		}
		modifier = {
			mult = value:growth_factor
			desc = growth_factor_desc
		}
		modifier = {
			mult = owner.value:negative_empire_size_percent
			desc = behemoth_empire_size_desc
		}
		modifier = {
			owner = { is_wilderness_empire = yes }
			add = 1
			desc = wilderness_behemoth
		}
	}

	approach = { # Brawn
		name = behemoth_finale_approach_brawn
		icon = GFX_situation_approach_fight
		icon_background = GFX_situation_approach_bg_red
		on_select = {
			custom_tooltip = behemoth_finale_approach_brawn_tooltip
		}
		modifier = {
			ship_fire_rate_mult = 0.15
			ship_armor_hardening_add = 0.5
		}
		resources = {
			cost = {
				food = 2500
			}
		}
	}

	approach = { # Digestion
		name = behemoth_finale_approach_digestion
		icon = GFX_situation_approach_digestion
		icon_background = GFX_situation_approach_bg_green
		on_select = {
			custom_tooltip = behemoth_finale_approach_digestion_tooltip
		}
		modifier = {
			ship_speed_reduction = 0.3
			ship_fire_rate_mult = -0.25
			ship_hull_regen_add_perc = 0.25
		}
		resources = {
			cost = {
				food = 2500
			}
		}
	}

	approach = { # Speed
		name = behemoth_finale_approach_speed
		icon = GFX_situation_approach_flight
		icon_background = GFX_situation_approach_bg_yellow
		default = yes
		modifier = {
			ship_speed_mult = 0.25
			ship_evasion_add = 5
		}
		resources = {
			cost = {
				food = 2500
			}
		}
	}



	on_monthly = {

	}
}

evolutionary_predators_situation = {
	picture = GFX_evt_evolutionary_predators
	complete_icon_frame = GFX_situation_outcome_frame_green
	complete_icon = GFX_situation_outcome_eat
	category = positive
	initial_progress = 0

	on_progress_complete = {
		custom_tooltip = evolutionary_predators_situation_outcome
		hidden_effect = {
			situation_event = { id = bio.1005 }
		}
	}

	on_start = {
		situation_event = { id = bio.1001 }
		if = {
			limit = {
				owner = { has_country_flag = evolutionary_predators_consume }
			}
			set_situation_approach = situation_evolutionary_predators_consume
		}
		else_if = {
			limit = {
				owner = { has_country_flag = evolutionary_predators_incorporate }
			}
			set_situation_approach = situation_evolutionary_predators_incorporate
		}
		else_if = {
			limit = {
				owner = { has_country_flag = evolutionary_predators_synthesize }
			}
			set_situation_approach = situation_evolutionary_predators_synthesize
		}
	}

	on_monthly = {
		events = {
			bio.1001
		}
	}

	stages = {
		stage_1 = {
			icon = GFX_situation_stage_eat
			icon_background = GFX_situation_stage_frame_green
			end = {
				base = 500
				mult = owner.num_evopred_situations_ran
			}
		}
	}

	approach = {
		name = situation_evolutionary_predators_consume
		icon = GFX_situation_approach_hungry
		allow = {
			owner = { can_have_slaves = yes }
		}
		icon_background = GFX_situation_approach_bg_yellow
		on_select = {
			custom_tooltip = evolutionary_predators_consume_tooltip
			owner = {
				remove_country_flag = evolutionary_predators_incorporate
				remove_country_flag = evolutionary_predators_synthesize
				set_country_flag = evolutionary_predators_consume
			}
		}
	}

	approach = {
		name = situation_evolutionary_predators_incorporate
		icon = GFX_situation_approach_incorporate
		icon_background = GFX_situation_approach_bg_yellow
		on_select = {
			custom_tooltip = evolutionary_predators_incorporate_tooltip
			owner = {
				remove_country_flag = evolutionary_predators_consume
				remove_country_flag = evolutionary_predators_synthesize
				set_country_flag = evolutionary_predators_incorporate
			}
		}
		default = yes
	}

	approach = {
		name = situation_evolutionary_predators_synthesize
		icon = GFX_situation_approach_synthesize
		icon_background = GFX_situation_approach_bg_yellow
		on_select = {
			custom_tooltip = evolutionary_predators_synthesize_tooltip
			owner = {
				remove_country_flag = evolutionary_predators_consume
				remove_country_flag = evolutionary_predators_incorporate
				set_country_flag = evolutionary_predators_synthesize
			}
		}
	}

	monthly_progress = {
		base = 0
		modifier = {
			add = owner.value:num_evolutionary_predators_planets
			desc = evolutionary_predators_planets
			check_variable_arithmetic = { which = owner.value:num_evolutionary_predators_planets value > 0 }
		}
		modifier = {
			add = owner.value:num_evolutionary_predators_purge
			desc = evolutionary_predators_purge
			check_variable_arithmetic = { which = owner.value:num_evolutionary_predators_purge value > 0 }
		}
		modifier = {
			add = owner.value:num_evolutionary_predators_species
			desc = evolutionary_predators_species
			check_variable_arithmetic = { which = owner.value:num_evolutionary_predators_species value > 0 }
		}
		modifier = {
			owner = { is_gestalt = no }
			add = owner.value:num_evolutionary_predators_council
			desc = evolutionary_predators_council
			check_variable_arithmetic = { which = owner.value:num_evolutionary_predators_council value > 0 }
		}
		modifier = {
			owner = { subjects > 0 }
			add = owner.value:num_evolutionary_predators_subjects
			desc = evolutionary_predators_subjects
			check_variable_arithmetic = { which = owner.value:num_evolutionary_predators_subjects value > 0 }
		}
		modifier = {
			owner = { is_megacorp = yes }
			add = owner.value:num_evolutionary_predators_megacorp
			desc = evolutionary_predators_megacorp
			check_variable_arithmetic = { which = owner.value:num_evolutionary_predators_megacorp value > 0 }
		}
		modifier = {
			owner = {
				has_modifier = agenda_mutation_divergence_evo_pred_finish
			}
			mult = 1.10		# Remember to update agenda_mutation_divergence_finish_evo_pred_tt if this value changes
			desc = agenda_mutation_divergence_evo_pred_finish
		}
		modifier = {
			owner = {
				has_tradition = tr_mutation_stage_3_swap
			}
			mult = 1.25		# Remember to update tr_mutation_nucleotide_isolation_evo_pred_tt if this value changes
			desc = tr_mutation_nucleotide_isolation
		}
	}
}