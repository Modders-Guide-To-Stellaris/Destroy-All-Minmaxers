
situation_initiate_storm = {
    title = situation_initiate_storm
    desc = {
        trigger = {
            current_situation_approach = approach_situation_initiate_storm_supercharge
        }
        text = situation_initiate_storm_desc_supercharge
    }
    desc = {
        trigger = {
            current_situation_approach = approach_situation_initiate_storm_overfeed
        }
        text = situation_initiate_storm_desc_overfeed
    }
    desc = {
        trigger = {
            current_situation_approach = approach_situation_initiate_storm_irradiate
        }
        text = situation_initiate_storm_desc_irradiate
    }
    desc = {
        trigger = {
            current_situation_approach = approach_situation_initiate_storm_sever
        }
        text = situation_initiate_storm_desc_sever
    }
    desc = {
        trigger = {
            current_situation_approach = approach_situation_initiate_storm_magnetize
        }
        text = situation_initiate_storm_desc_magnetize
    }
    desc = {
        trigger = {
            current_situation_approach = approach_situation_initiate_storm_agitate
        }
        text = situation_initiate_storm_desc_agitate
    }
    desc = {
        trigger = {
            current_situation_approach = approach_situation_initiate_storm_destabilize
        }
        text = situation_initiate_storm_desc_destabilize
    }
    desc = {
        trigger = {
            current_situation_approach = approach_situation_initiate_storm_scramble
        }
        text = situation_initiate_storm_desc_scramble
    }

    picture = {
        trigger = {
            OR = {
                current_situation_approach = approach_situation_initiate_storm_supercharge
                current_situation_approach = approach_situation_initiate_storm_irradiate
                current_situation_approach = approach_situation_initiate_storm_sever
                current_situation_approach = approach_situation_initiate_storm_magnetize
            }
        }
        picture = GFX_evt_cosmic_storms_supercharge
    }
    picture = {
        trigger = {
            OR = {
                current_situation_approach = approach_situation_initiate_storm_overfeed
                current_situation_approach = approach_situation_initiate_storm_agitate
                current_situation_approach = approach_situation_initiate_storm_destabilize
                current_situation_approach = approach_situation_initiate_storm_scramble
            }
        }
        picture = GFX_evt_cosmic_storms_overfeed
    }
    category = neutral
    complete_icon_frame = GFX_situation_outcome_frame_green
    complete_icon = GFX_situation_outcome_positive
    start_value = 0

    on_start = {
        target = {
            random_fleet_in_orbit = {
                limit = {
                    is_owned_by = root.owner
                    has_fleet_order = initiate_cosmic_storm_order
                }
                set_fleet_flag = is_initiating_storm_at@root.target
                leader = { save_event_target_as = storm_researcher }
            }
        }
        situation_event = { id = cstorms.2000 }
    }

    on_abort = {
        owner = {
            every_owned_fleet = {
                limit = { has_fleet_flag = is_initiating_storm_at@root.target }
                remove_fleet_flag = is_initiating_storm_at@root.target
            }
        }
    }
    abort_trigger = {
        OR = {
            NOT = { exists = target }
            target = {
                NOT = {
                    any_fleet_in_orbit = {
                        is_owned_by = root.owner
                        has_fleet_order = initiate_cosmic_storm_order
                    }
                }
            }
        }
    }

    stages = {
        stage_1 = {
            icon = GFX_situation_stage_1
            icon_background = GFX_situation_stage_frame_green
            end = 25
        }
        stage_2 = {
            icon = GFX_situation_stage_2
            icon_background = GFX_situation_stage_frame_green
            end = 50
            on_first_enter = {
                owner = {
                    random_owned_fleet = {
                        limit = { has_fleet_flag = is_initiating_storm_at@root.target }
                        leader = { save_event_target_as = storm_researcher }
                    }
                }
                if = {
                    limit = { current_situation_approach = approach_situation_initiate_storm_supercharge }
                    situation_event = { id = cstorms.2010 }
                }
                else_if = {
                    limit = { current_situation_approach = approach_situation_initiate_storm_overfeed }
                    situation_event = { id = cstorms.2015 }
                }
            }
        }
    }

    on_progress_complete = {
        custom_tooltip = situation_initiate_storm_finisher_effects
        hidden_effect = {
            set_situation_locked = yes
            set_situation_flag = situation_locked
            owner = {
                random_owned_fleet = {
                    limit = { has_fleet_flag = is_initiating_storm_at@root.target }
                    leader = { save_event_target_as = storm_researcher }
                    remove_fleet_flag = is_initiating_storm_at@root.target
                }
            }
            if = {
                limit = { current_situation_approach = approach_situation_initiate_storm_irradiate }
                situation_event = { id = cstorms.2020 }
            }
            else_if = {
                limit = { current_situation_approach = approach_situation_initiate_storm_sever }
                situation_event = { id = cstorms.2025 }
            }
            else_if = {
                limit = { current_situation_approach = approach_situation_initiate_storm_magnetize }
                situation_event = { id = cstorms.2030 }
            }
            else_if = {
                limit = { current_situation_approach = approach_situation_initiate_storm_agitate }
                situation_event = { id = cstorms.2035 }
            }
            else_if = {
                limit = { current_situation_approach = approach_situation_initiate_storm_destabilize }
                situation_event = { id = cstorms.2040 }
            }
            else_if = {
                limit = { current_situation_approach = approach_situation_initiate_storm_scramble }
                situation_event = { id = cstorms.2045 }
            }
        }
    }

    approach = {
        name = approach_situation_initiate_storm_supercharge
        icon = GFX_situation_approach_energy_credits
        icon_background = GFX_situation_approach_bg_green
        potential = { current_stage = stage_1 }
        allow = {
            custom_tooltip = {
                fail_text = approach_situation_locked_tt
                has_situation_flag = approach_supercharge_selected
            }
        }
        resources = {
            category = situations
            upkeep = {
                energy = 200
            }
        }
        on_select = {
            custom_tooltip = approach_situation_initiate_storm_supercharge_tt
        }
    }
    approach = {
        name = approach_situation_initiate_storm_overfeed
        icon = GFX_situation_approach_minerals
        icon_background = GFX_situation_approach_bg_green
        potential = { current_stage = stage_1 }
        allow = {
            custom_tooltip = {
                fail_text = approach_situation_locked_tt
                has_situation_flag = approach_overfeed_selected
            }
        }
        resources = {
            category = situations
            upkeep = {
                minerals = 100
            }
        }
        on_select = {
            custom_tooltip = approach_situation_initiate_storm_overfeed_tt
        }
    }
    approach = {
        name = approach_situation_initiate_storm_irradiate
        icon = GFX_situation_approach_alloys
        icon_background = GFX_situation_approach_bg_green
        potential = {
            current_stage = stage_2
            has_situation_flag = approach_supercharge_selected
        }
        allow = {
            custom_tooltip = {
                fail_text = approach_situation_locked_tt
                has_situation_flag = approach_irradiate_selected
            }
        }
        resources = {
            category = situations
            upkeep = {
                alloys = @irradiate_alloy_upkeep
            }
        }
        on_select = {
            custom_tooltip = approach_situation_initiate_storm_irradiate_tt
        }
    }
    approach = {
        name = approach_situation_initiate_storm_sever
        icon = GFX_situation_approach_energy_credits
        icon_background = GFX_situation_approach_bg_green
        potential = {
            current_stage = stage_2
            has_situation_flag = approach_supercharge_selected
        }
        allow = {
            custom_tooltip = {
                fail_text = approach_situation_locked_tt
                has_situation_flag = approach_sever_selected
            }
        }
        resources = {
            category = situations
            upkeep = {
                energy = @sever_energy_upkeep
            }
        }
        on_select = {
            custom_tooltip = approach_situation_initiate_storm_sever_tt
        }
    }
    approach = {
        name = approach_situation_initiate_storm_magnetize
        icon = GFX_situation_approach_minerals
        icon_background = GFX_situation_approach_bg_green
        potential = {
            current_stage = stage_2
            has_situation_flag = approach_supercharge_selected
        }
        allow = {
            custom_tooltip = {
                fail_text = approach_situation_locked_tt
                has_situation_flag = approach_magnetize_selected
            }
        }
        resources = {
            category = situations
            upkeep = {
                minerals = @magnetize_mineral_upkeep
            }
        }
        on_select = {
            custom_tooltip = approach_situation_initiate_storm_magnetize_tt
        }
    }
    approach = {
        name = approach_situation_initiate_storm_agitate
        icon = GFX_situation_approach_volatile_motes
        icon_background = GFX_situation_approach_bg_green
        potential = {
            current_stage = stage_2
            has_situation_flag = approach_overfeed_selected
        }
        allow = {
            custom_tooltip = {
                fail_text = approach_situation_locked_tt
                has_situation_flag = approach_agitate_selected
            }
        }
        resources = {
            category = situations
            upkeep = {
                volatile_motes = @rare_resource_upkeep
            }
        }
        on_select = {
            custom_tooltip = approach_situation_initiate_storm_agitate_tt
        }
    }
    approach = {
        name = approach_situation_initiate_storm_destabilize
        icon = GFX_situation_approach_dark_matter
        icon_background = GFX_situation_approach_bg_green
        potential = {
            current_stage = stage_2
            has_situation_flag = approach_overfeed_selected
        }
        allow = {
            custom_tooltip = {
                fail_text = approach_situation_locked_tt
                has_situation_flag = approach_destabilize_selected
            }
        }
        resources = {
            category = situations
            upkeep = {
                sr_dark_matter = @rare_resource_upkeep
            }
        }
        on_select = {
            custom_tooltip = approach_situation_initiate_storm_destabilize_tt
        }
    }
    approach = {
        name = approach_situation_initiate_storm_scramble
        icon = GFX_situation_approach_rare_crystals
        icon_background = GFX_situation_approach_bg_green
        potential = {
            current_stage = stage_2
            has_situation_flag = approach_overfeed_selected
        }
        allow = {
            custom_tooltip = {
                fail_text = approach_situation_locked_tt
                has_situation_flag = approach_scramble_selected
            }
        }
        resources = {
            category = situations
            upkeep = {
                rare_crystals = @rare_resource_upkeep
            }
        }
        on_select = {
            custom_tooltip = approach_situation_initiate_storm_scramble_tt
        }
    }
    approach = {
        name = approach_situation_initiate_storm_abort
        icon = GFX_situation_approach_suspicious
        icon_background = GFX_situation_approach_bg_red
        potential = {
            NOT = { has_situation_flag = situation_locked }
        }
        on_select = {
            abort_situation = this
        }
    }

    monthly_progress = {
        base = 0
        modifier = {
            desc = string_current_approach
            add = 2
            current_situation_approach = approach_situation_initiate_storm_supercharge
        }
        modifier = {
            desc = string_current_approach
            add = @default_monthly_progress
            current_situation_approach = approach_situation_initiate_storm_overfeed
        }
        modifier = {
            desc = string_current_approach
            add = @default_monthly_progress
            current_situation_approach = approach_situation_initiate_storm_irradiate
        }
        modifier = {
            desc = string_current_approach
            add = @default_monthly_progress
            current_situation_approach = approach_situation_initiate_storm_sever
        }
        modifier = {
            desc = string_current_approach
            add = @default_monthly_progress
            current_situation_approach = approach_situation_initiate_storm_magnetize
        }
        modifier = {
            desc = string_current_approach
            add = @default_monthly_progress
            current_situation_approach = approach_situation_initiate_storm_agitate
        }
        modifier = {
            desc = string_current_approach
            add = @default_monthly_progress
            current_situation_approach = approach_situation_initiate_storm_destabilize
        }
        modifier = {
            desc = string_current_approach
            add = @default_monthly_progress
            current_situation_approach = approach_situation_initiate_storm_scramble
        }
    }
}