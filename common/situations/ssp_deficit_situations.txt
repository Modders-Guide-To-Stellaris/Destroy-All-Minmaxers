ssp_situation_artifact_deficit = {
    picture = GFX_evt_deficit
    category = negative
    fail_icon = GFX_situation_outcome_meh
    fail_icon_frame = GFX_situation_outcome_frame_green
    complete_icon = GFX_situation_outcome_bankrupcy
    complete_icon_frame = GFX_situation_outcome_frame_red

    on_start = {
        set_situation_flag = deficit_situation
        owner = {
            country_event = { id = ssp_deficit.10 days = 10 random = 20 }
        }
    }
    on_abort = {
        owner = {
            add_resource = {
                minor_artifacts = @bailout_basic_base_amount
                mult = value:bailout_scaling_factor
            }
        }
    }

    start_value = 15
    on_monthly = {
        random_events = {
            5 = ssp_deficit.2001
        }
    }

    stages = {
        deficit_first = {
            icon = GFX_situation_stage_1
            icon_background = GFX_situation_stage_frame_red
            end = 25
            modifier = {
                planet_researchers_physics_research_produces_add = -1
                planet_researchers_society_research_produces_add = -1
                planet_researchers_engineering_research_produces_add = -1
                diplo_weight_economy_mult = -0.1
            }
            triggered_modifier = {
                potential = {
                    owner = {
                        has_ascension_perk = ap_archaeoengineers
                    }
                }
                modifier = {
                    ship_disengage_chance_mult = -0.1
                    ship_weapon_damage = -0.20
                    ship_speed_mult = -0.20
                    weapon_archaeotech_weapon_damage_mult = -0.1
                }
            }
        }

        deficit_second = {
            icon = GFX_situation_stage_2
            icon_background = GFX_situation_stage_frame_red
            end = 50
            modifier = {
                planet_researchers_physics_research_produces_add = -1.5
                planet_researchers_society_research_produces_add = -1.5
                planet_researchers_engineering_research_produces_add = -1.5
                diplo_weight_economy_mult = -0.2
                weapon_archaeotech_weapon_fire_rate_mult= -0.125
            }
            triggered_modifier = {
                potential = {
                    owner = {
                        has_ascension_perk = ap_archaeoengineers
                    }
                }
                modifier = {
                    ship_disengage_chance_mult = -0.25
                    ship_weapon_damage = -0.40
                    ship_speed_mult = -0.40
                    weapon_archaeotech_weapon_damage_mult = -0.25
                }
            }
        }
        deficit_third = {
            icon = GFX_situation_stage_3
            icon_background = GFX_situation_stage_frame_red
            end = 75
            modifier = {
                planet_researchers_physics_research_produces_add = -2
                planet_researchers_society_research_produces_add = -2
                planet_researchers_engineering_research_produces_add = -2
                diplo_weight_economy_mult = -0.33
                weapon_archaeotech_weapon_fire_rate_mult= -0.25
            }
            triggered_modifier = {
                potential = {
                    owner = {
                        has_ascension_perk = ap_archaeoengineers
                    }
                }
                modifier = {
                    ship_disengage_chance_mult = -0.50
                    ship_weapon_damage = -0.60
                    ship_speed_mult = -0.60
                    weapon_archaeotech_weapon_damage_mult = -0.5
                }
            }
        }
        deficit_fourth = {
            icon = GFX_situation_stage_4
            icon_background = GFX_situation_stage_frame_red
            end = 100
            on_first_enter = {
                situation_event = { id = deficit.100 } #todo: change this
            }
            modifier = {
                planet_researchers_physics_research_produces_add = -3
                planet_researchers_society_research_produces_add = -3
                planet_researchers_engineering_research_produces_add = -3
                diplo_weight_economy_mult = -0.5
                planet_pop_assembly_reduction = 0.5
                planet_jobs_produces_mult = -0.1
                weapon_archaeotech_weapon_fire_rate_mult= -0.5
            }
            triggered_modifier = {
                potential = {
                    owner = {
                        has_ascension_perk = ap_archaeoengineers
                    }
                }
                modifier = {
                    ship_disengage_chance_mult = -0.75
                    ship_weapon_damage = -0.8
                    ship_speed_mult = -0.8
                    weapon_archaeotech_weapon_damage_mult = -1
                }
            }
        }
    }

    on_progress_complete = {
        country_defaulted_in_situation_tooltip = yes
        hidden_effect = {
            situation_event = { id = deficit.110 }
            owner = {
                if = {
                    limit = {
                        NOT = {
                            has_global_flag = BritishMuseumVanquished
                        }
                    }
                    country_event = { id = ssp_deficit.20 }
                }
            }
        }
    }
    on_fail = {
        custom_tooltip = deficit_situation_finish_tooltip
        hidden_effect = { destroy_situation = this }
    }
    monthly_progress = {
        base = 0
        modifier = {
            add = value:deficit_situation_progress_value|RESOURCE|minor_artifacts|
            desc = string_expenditures_greater_than_income_artifact
            owner = { has_actual_deficit = { RESOURCE = minor_artifacts } }
        }
        modifier = {
            subtract = 5
            desc = string_not_in_deficit_artifact
            owner = {
                resource_income_compare = {
                    resource = minor_artifacts
                    value >= 0
                }
            }
        }
        modifier = {
            subtract = 1
            desc = string_resource_reserves_artifact
            owner = {
                has_negative_income_with_stockpile = { RESOURCE = minor_artifacts }
            }
        }
        modifier = {
            desc = civilian_difficulty
            mult = 0.1
            situation_monthly_progress > 0
            is_difficulty = 0
            owner = {
                is_ai = no
            }
        }
        modifier = {
            desc = cadet_difficulty
            mult = 0.5
            situation_monthly_progress > 0
            is_difficulty = 1
            owner = {
                is_ai = no
            }
        }
    }
    approach = {
        name = deficit_approach_do_nothing
        icon = GFX_situation_approach_this_is_fine
        icon_background = GFX_situation_approach_bg_yellow
        default = yes
        on_select = {
            custom_tooltip = deficit_approach_do_nothing_tooltip
        }
        ai_weight = {
            base = 1
        }
    }
    approach = {
        name = deficit_approach_reorder_scientific_structure
        icon = GFX_situation_approach_research
        icon_background = GFX_situation_approach_bg_red
        modifier = {
            planet_researchers_produces_mult = -1
            planet_jobs_minor_artifacts_produces_mult = 2
        }

        ai_weight = {
            base = 0
            modifier = {
                add = 2
                current_stage = deficit_third
            }
            modifier = {
                add = 2
                current_stage = deficit_fourth
            }
        }
    }
    approach = {
        name = deficit_approach_open_artifact_caches
        icon = GFX_situation_approach_this_is_fine
        icon_background = GFX_situation_approach_bg_green

        potential = {
            owner = {
                NOT = {
                    has_country_flag = broken_caches
                }
            }
            situation_progress >= 50
        }

        on_select = {
            owner = {
                country_event = { id = ssp_deficit.1 days = 1 }
            }
            set_situation_approach = deficit_approach_do_nothing
        }
    }
}