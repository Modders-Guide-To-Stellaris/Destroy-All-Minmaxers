namespace = HGTS

country_event = {
    id = HGTS.1
    hide_window = yes
    fire_only_once = yes
    is_triggered_only = yes

    immediate = {
        set_country_flag = host

        set_variable = {
            value = value:hgts_gestalts_over_limit
            which = var_hgts_gestalts_over_limit
        }
    }
}

#Crisis gets all relations wiped (womp womp, shouldnt have been T3)
country_event = {
    id = HGTS.100
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        AND = {
            hgts_is_definitive_crisis = yes
            NOT = { has_country_flag = empire_got_nuked_lol }
        }
    }

    immediate = {
        every_playable_country = {
            if = {
                limit = {
                    NOR = {
                        is_same_value = root
                        has_country_flag = hgts_crisis_relations_wipe_excluded
                    }
                }
                clear_relations = {
                    relations = {
                        commercial_pact
                        research_agreement
                        defensive_pact
                        migration_access
                    }
                    target = root
                }
            }
        }
        set_country_flag = empire_got_nuked_lol
    }
}

## HOST - DASHBOARD
country_event = {
    id = HGTS.10000
    is_triggered_only = yes
    picture = GFX_evt_worrying_signal
    title = "HGTS_DASHBOARD"
    desc = "HGTS_DASHBOARD_DESC"

    option = {
        name = HGTS_RULES
        country_event = {
            id = HGTS.11000
        }
    }
    option = {
        name = CLOSE
    }
}

country_event = {
    id = HGTS.10001
    is_triggered_only = yes
    picture = GFX_evt_worrying_signal
    title = "HGTS_HOST_SUMMON"
    message_desc = "HGTS_HOST_SUMMON_DESC"

    #Gestalt
    desc = {
        text = HGTS_HOST_SUMMON_GESTALT
        trigger = {
            has_country_flag = HGTS_GESTALT_SUMMON
        }
    }

    option = {
        name = WORRYING
    }

    after = {
        if = {
            limit = {
                has_global_flag = HGTS_GESTALT_SUMMON
            }
            remove_global_flag = HGTS_GESTALT_SUMMON
        }
    }
}

#Empire / Rule Enforcement
country_event = {
    id = HGTS.11000
    is_triggered_only = yes
    title = "HGTS_RULES"

    option = {
        name = HGTS_BACK
        country_event = {
            id = HGTS.10000
        }
    }
    option = {
        name = GESTALT_CHECK
        country_event = {
            id = HGTS.11100
        }
    }
}

country_event = {
    id = HGTS.11100
    is_triggered_only = yes
    title = GESTALT_CHECK
    desc = HGTS_GESTALT_AMOUNT

    immediate = {
        if = {
            limit = {
                #ONLY POSSIBLE IF THERES MORE GESTALTS THAN ALLOWED (0 means every slot is taken, lower means more gestalts)
                check_variable = {
                    which = var_hgts_gestalts_over_limit
                    value > 0
                }
            }
            set_global_flag = HGTS_GESTALT_SUMMON
        }
    }

    option = {
        name = HGTS_AGREE
        every_playable_country = {
            limit = {
                is_gestalt = yes
            }
            country_event = {
                id = HGTS.10001
            }
        }

        allow = {
            has_global_flag = HGTS_GESTALT_SUMMON
        }
    }

    option = {
        name = HGTS_DISAGREE
        remove_global_flag = HGTS_GESTALT_SUMMON
    }

    after = {
        country_event = {
            id = HGTS.10000
        }
    }
}

#Host Cheats
# country_event = {
#     id = HGTS.12000
#     is_triggered_only = yes
# }

# Enable/Disable Game Features
# country_event = {
#     id = HGTS.13000
#     is_triggered_only = yes
# }