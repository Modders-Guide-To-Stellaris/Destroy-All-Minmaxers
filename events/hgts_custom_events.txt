namespace = HGTS

country_event = {
    id = HGTS.1
    hide_window = yes
    fire_only_once = yes
    is_triggered_only = yes

    immediate = {
        set_country_flag = host

        set_global_flag = HGTS_HOST_CRISIS_TYPE_OVERRIDE

        #Initialization
        country_event = {
            id = HGTS.2
        }
    }
}

country_event = {
    id = HGTS.2
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        set_variable = {
            value = value:hgts_gestalts_over_limit
            which = var_hgts_gestalts_over_limit
        }
    }
}

#Crisis gets all relations wiped (womp womp, shouldnt have been T3)
country_event = {
    id = HGTS.100
    is_triggered_only = yes
    hide_window = yes

    trigger = {
        AND = {
            hgts_is_definitive_crisis = yes
            NOT = { has_country_flag = empire_got_nuked_lol }
        }
    }

    immediate = {
        every_playable_country = {
            if = {
                limit = {
                    NOR = {
                        is_same_value = root
                        has_country_flag = hgts_crisis_relations_wipe_excluded
                    }
                }
                clear_relations = {
                    relations = {
                        commercial_pact
                        research_agreement
                        defensive_pact
                        migration_access
                    }
                    target = root
                }
            }
        }
        set_country_flag = empire_got_nuked_lol
    }
}

## HOST - DASHBOARD
country_event = {
    id = HGTS.10000
    is_triggered_only = yes
    picture = GFX_evt_worrying_signal
    title = "HGTS_DASHBOARD"
    desc = "HGTS_DASHBOARD_DESC"

    option = {
        name = CLOSE
    }

    option = {
        name = HGTS_RULES
        country_event = {
            id = HGTS.11000
        }
    }

    option = {
        name = HGTS_CRISIS_SPEEDDIAL
        country_event = {
            id = HGTS.12000
        }
    }

    option = {
        name = HGTS_HOST_GAME_FEATURES
        country_event = {
            id = HGTS.13000
        }
    }
}

country_event = {
    id = HGTS.10001
    is_triggered_only = yes
    picture = GFX_evt_worrying_signal
    title = "HGTS_HOST_SUMMON"
    message_desc = "HGTS_HOST_SUMMON_DESC"

    #Gestalt
    desc = {
        text = HGTS_HOST_SUMMON_GESTALT
        trigger = {
            has_country_flag = HGTS_GESTALT_SUMMON
        }
    }

    option = {
        name = WORRYING
    }

    after = {
        if = {
            limit = {
                has_global_flag = HGTS_GESTALT_SUMMON
            }
            remove_global_flag = HGTS_GESTALT_SUMMON
        }
    }
}

#Empire / Rule Enforcement
country_event = {
    id = HGTS.11000
    is_triggered_only = yes
    title = "HGTS_RULES"

    option = {
        name = HGTS_BACK
        country_event = {
            id = HGTS.10000
        }
    }
    option = {
        name = GESTALT_CHECK
        country_event = {
            id = HGTS.11100
        }
    }
}

country_event = {
    id = HGTS.11100
    is_triggered_only = yes
    title = GESTALT_CHECK
    desc = HGTS_GESTALT_AMOUNT

    immediate = {
        if = {
            limit = {
                #ONLY POSSIBLE IF THERES MORE GESTALTS THAN ALLOWED (0 means every slot is taken, lower means more gestalts)
                check_variable = {
                    which = var_hgts_gestalts_over_limit
                    value > 0
                }
            }
            set_global_flag = HGTS_GESTALT_SUMMON
        }
    }

    option = {
        name = HGTS_AGREE
        every_playable_country = {
            limit = {
                is_gestalt = yes
            }
            country_event = {
                id = HGTS.10001
            }
        }

        allow = {
            has_global_flag = HGTS_GESTALT_SUMMON
        }
    }

    option = {
        name = HGTS_DISAGREE
        remove_global_flag = HGTS_GESTALT_SUMMON
    }

    after = {
        country_event = {
            id = HGTS.11000
        }
    }
}

# Host Cheats
country_event = {
    id = HGTS.12000
    is_triggered_only = yes
    title = "HGTS_CRISIS_SPEEDDIAL"
    desc = "HGTS_CRISIS_SPEEDDIAL_DESC"
    picture = GFX_evt_khan_throne_room

    option = {
        name = HGTS_BACK
        country_event = {
            id = HGTS.10000
        }
    }

    ## MIDGAME CRISIS'
    option = {
        allow = {
            AND = {
                OR = {
                    mid_game_years_passed >= 0
                    has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
                }
                NOT = { has_global_flag = marauder_crisis_started }
                any_country = {
                    is_country_type = dormant_marauders
                }
            }
        }

        name = "HGTS_SUMMON_KHAN"
        country_event = {
            id = HGTS.12100
            random = 360
        }
    }

    option = {
        allow = {
            AND = {
                OR = {
                    mid_game_years_passed >= 0
                    has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
                }
                NOT = { has_global_flag = voidworms_plague_crisis_started }
            }
        }

        name = "HGTS_RALLY_VOIDWORMS"
        country_event = {
            id = HGTS.12110
            random = 360
        }
    }

    ## ENDGAME CRISIS'
    option = {
        allow = {
            AND = {
                OR = {
                    end_game_years_passed >= 0
                    has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
                }
                NOR = {
                    has_global_flag = HGTS_HOST_CRISIS_TYPE_OVERRIDE
                    has_global_flag = galactic_crisis_recently_fired
                }
            }
        }

        name = "HGTS_SUMMON_SCOURGE"
        country_event = {
            id = HGTS.12300
            random = 360
        }
    }

    option = {
        allow = {
            AND = {
                OR = {
                    end_game_years_passed >= 0
                    has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
                }

                NOR = {
                    has_global_flag = HGTS_HOST_CRISIS_TYPE_OVERRIDE
                    has_global_flag = galactic_crisis_recently_fired
                }
            }
        }

        name = "HGTS_SUMMON_CONTINGENCY"
        country_event = {
            id = HGTS.12310
            random = 360
        }
    }

    option = {
        allow = {
            AND = {
                OR = {
                    end_game_years_passed >= 0
                    has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
                }

                NOR = {
                    has_global_flag = HGTS_HOST_CRISIS_TYPE_OVERRIDE
                    has_global_flag = galactic_crisis_recently_fired
                }
            }
        }

        name = "HGTS_SUMMON_UNBIDDEN"
        country_event = {
            id = HGTS.12320
            random = 360
        }
    }

    option = {
        allow = {
            AND = {
                OR = {
                    end_game_years_passed >= 0
                    has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
                }
                has_global_flag = extradimensional_invasion_happened
            }
        }

        name = "HGTS_SUMMON_ABBERANT"
        country_event = {
            id = HGTS.12330
            random = 360
        }
    }

    option = {
        allow = {
            AND = {
                OR = {
                    end_game_years_passed >= 0
                    has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
                }
                has_global_flag = HGTS_ABBERANT_HAPPEN
            }
        }

        name = "HGTS_SUMMON_VEHEMENT"
        country_event = {
            id = HGTS.12340
            random = 360
        }
    }

    option = {
        allow = {
            AND = {
                OR = {
                    end_game_years_passed >= 0
                    has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
                }

                AND = {
                    any_country = {
                        is_country_type = fallen_empire
                        is_gestalt = no
                    }
                    NOT = { has_global_flag = war_in_heaven_ongoing }
                }

                NOR = {
                    has_global_flag = HGTS_HOST_CRISIS_TYPE_OVERRIDE
                    has_global_flag = galactic_crisis_recently_fired
                }
            }
        }

        name = "HGTS_SUMMON_BORING_CRISIS"
        country_event = {
            id = HGTS.12350
            random = 360
        }
    }

    ## FALLEN EMPIRES
    # option = {
    #     allow = {
    #         AND = {
    #             OR = {
    #                 end_game_years_passed >= 0
    #                 has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
    #             }
    #             NOT = { has_global_flag = sleepers_awake_happened }
    #             any_country = {
    #                 AND = {
    #                     is_country_type = fallen_empire
    #                     is_gestalt = no
    #                 }
    #             }
    #         }
    #     }

        ## disabled, doesnt work lol
        # name = "HGTS_AWAKEN"
        # country_event = {
        #     id = HGTS.12400
        # }
    # }

    # option = {
    #     allow = {
    #         mid_game_years_passed >= 0
    #         fallen
    #     }
    #
    #     name = "NAME_The_War_in_Heaven"
    #     country_event = {
    #         id = HGTS.12410
    #         random = 180
    #     }
    # }

    after = {
        country_event = {
            id = HGTS.10000
        }
    }
}

# I'm not making funny visuals for this
#Khan
country_event = {
    id = HGTS.12100
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        random_country = {
            limit = {
                is_country_type = dormant_marauders
            }
            set_global_flag = horde_triggered
            country_event = { id = marauder.500 }
        }
    }
}

#Voidworm, why, why would you want to press this button?
country_event = {
    id = HGTS.12110
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        random_country = {
            limit = {
                is_country_type = voidworms
            }
            country_event = { id = grand_archive.2300 }
        }
    }
}

#Scourge
country_event = {
    id = HGTS.12300
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        country_event = { id = crisis.10 days = 200 random = 800 }
        set_global_flag = galactic_crisis_happened
        set_timed_global_flag = {
            flag = galactic_crisis_recently_fired
            years = 12
        }
    }
}

#Contingency
country_event = {
    id = HGTS.12310
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        country_event = { id = crisis.2005 days = 200 random = 800 }
        set_global_flag = galactic_crisis_happened
        set_timed_global_flag = {
            flag = galactic_crisis_recently_fired
            years = 12
        }
    }
}

#Unbidden Pt. 1
country_event = {
    id = HGTS.12320
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        country_event = { id = crisis.1000 days = 200 random = 800 }
        set_global_flag = galactic_crisis_happened
        set_timed_global_flag = {
            flag = galactic_crisis_recently_fired
            years = 12
        }
    }
}

#Unbidden Pt. 2
country_event = {
    id = HGTS.12330
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        country_event = {
            id = crisis.1100
        }

        set_global_flag = HGTS_ABBERANT_HAPPEN
    }
}

#Unbidden Pt. 3
country_event = {
    id = HGTS.12340
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        country_event = { id = crisis.1111 }
    }
}

#Cetena
country_event = {
    id = HGTS.12350
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        country_event = { id = crisis.8005 days = 200 random = 800 }
        set_global_flag = galactic_crisis_happened
        set_timed_global_flag = {
            flag = galactic_crisis_recently_fired
            years = 12
        }
    }
}

# #Awaken a fallen
# country_event = {
#     id = HGTS.12400
#     is_triggered_only = yes
#     hide_window = yes
#
#     immediate = {
#         random_country = {
#             limit = {
#                 AND = {
#                     is_fallen_empire = yes
#                     is_gestalt = no
#                 }
#             }
#             country_event = { id = fallen_empires_awakening.1 }
#         }
#     }
# }

# #War in Heaven
# country_event = {
#     id = HGTS.12410
#     is_triggered_only = yes
# }

# Enable/Disable Game Features
country_event = {
    id = HGTS.13000
    is_triggered_only = yes
    title = "HGTS_HOST_GAME_FEATURES"
    picture = GFX_evt_financial_instruments

    option = {
        name = HGTS_BACK
        country_event = {
            id = HGTS.10000
        }
    }

    option = {
        default_hide_option = yes

        name = HGTS_HOST_OVERRIDE_DISABLED
        allow = {
            has_global_flag = HGTS_HOST_CRISIS_TYPE_OVERRIDE
        }

        country_event = {
            id = HGTS.13100
        }
    }

    option = {
        default_hide_option = yes

        name = HGTS_HOST_OVERRIDE_ENABLED
        allow = {
            NOT = { has_global_flag = HGTS_HOST_CRISIS_TYPE_OVERRIDE }
        }

        country_event = {
            id = HGTS.13100
        }
    }

    option = {
        default_hide_option = yes

        name = HGTS_HOST_OVERRIDE_TIME_DISABLED
        allow = {
            NOT = { has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE }
        }

        country_event = {
            id = HGTS.13110
        }
    }

    option = {
        default_hide_option = yes

        name = HGTS_HOST_OVERRIDE_TIME_ENABLED
        allow = {
            has_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
        }

        country_event = {
            id = HGTS.13110
        }
    }

    after = {
        country_event = {
            id = HGTS.10000
        }
    }
}

country_event = {
    id = HGTS.13100
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        switch = {
            trigger = has_global_flag

            HGTS_HOST_CRISIS_TYPE_OVERRIDE = {
                remove_global_flag = HGTS_HOST_CRISIS_TYPE_OVERRIDE
            }
            default = {
                set_global_flag = HGTS_HOST_CRISIS_TYPE_OVERRIDE
            }
        }
    }
}

country_event = {
    id = HGTS.13110
    is_triggered_only = yes
    hide_window = yes

    immediate = {
        switch = {
            trigger = has_global_flag

            HGTS_HOST_CRISIS_TIME_OVERRIDE = {
                remove_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
            }
            default = {
                set_global_flag = HGTS_HOST_CRISIS_TIME_OVERRIDE
            }
        }
    }
}